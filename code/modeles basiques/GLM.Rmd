---
title: "R Notebook"
output: html_notebook
---

## Chargement des librairies et des données.
```{r}
library(ggplot2)
library(tidyverse)
source("~/suivi-du-data-camp-DeSantiago_Boulahfa_Akrout/code/projet_fct.R")
```

```{r}
data = read.csv("~/suivi-du-data-camp-DeSantiago_Boulahfa_Akrout/code/data_train.csv")
head(data)
data=data[,-1]
head(data)
```

```{r}
data=data %>% mutate(sequence = as.factor(sequence)) %>% 
  #mutate(index_sequence = as.factor(index_sequence)) %>% 
  mutate(seq_be = as.factor(seq_be)) %>% 
  mutate(seq_af = as.factor(seq_af)) %>% 
  mutate(sequence = as.factor(sequence)) %>% 
  mutate(structure = as.factor(structure)) %>%
  mutate(struct_be = as.factor(struct_be)) %>% 
  mutate(struct_af = as.factor(struct_af)) %>% 
  mutate(predicted_loop_type = as.factor(predicted_loop_type)) %>% 
  mutate(loop_type_be = as.factor(loop_type_be)) %>% 
  mutate(loop_type_af = as.factor(loop_type_af)) 
```


On filtre maintenant les données qui ont SN_filter=0 :

```{r}
print(sum(is.na(data)))
print(sum(data$SN_filter==0)/68) ## Nombre d'individus dont le SN_filter=0
data=data[data$SN_filter==1,]
rownames(data)=NULL#1:108052
```

Mise à 0 des valeurs négatives
```{r}
p=dim(data)[2]
sum(data[,(p-4):p]<0)
for (i in (p-4):p){
  data[which(data[,i]<0),i]=0
} 
sum(data[,(p-4):p]<0)
```

## Création de la base train/validation :

```{r}
tamp=train_test_split(data)
data_train=tamp$train
data_val=tamp$val
```


```{r}
sum(is.na(data_train))
sum(is.na(data_val))
dim(data_train)[1]+dim(data_val)[1]-dim(data)[1]
```


```{r}
#rm(tamp,data)
```

## Test sur les lois

```{r}
M=mean(data_train$reactivity,na.rm = TRUE)
S=var(data_train$reactivity,na.rm = TRUE)
print(M)
print(S)
```

```{r}
ks.test(data_train$reactivity,"pexp",1/M)
```

```{r}
alpha_LoiGamma=(M^2)/(S-M^2)
beta_LoiGamma=(S-M^2)/M
ks.test(data_train$reactivity,"pgamma",alpha_LoiGamma,beta_LoiGamma)
```


## Modèles simples : GLM : loi Gamma et inverse.gaussian

On prédira la variable + un bruit (1e-12) pour que le support de la densité des labels soit dans $\mathbb{R}^*_+$.

### Reactivity

#### Loi Gamma

Ici on fera énormément de tests pour essayer de voir quels variables apportent des informations utiles.

```{r}
model=glm(reactivity+1e-12~sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```

```{r}
model=glm(reactivity+1e-12~(sequence+seq_be+seq_af),family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```

```{r}
model=glm(reactivity+1e-12~sequence+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```


```{r}
model=glm(reactivity+1e-12~sequence+predicted_loop_type+index_sequence,family = Gamma,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```



```{r}
model=glm(reactivity+1e-12~sequence+structure+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

```


#### Inverse.gaussian

```{r}
model=glm(reactivity+1e-12~sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```

```{r}
model=glm(reactivity+1e-12~(sequence+seq_be+seq_af),family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```

```{r}
model=glm(reactivity+1e-12~sequence+index_sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```


```{r}
model=glm(reactivity+1e-12~sequence+predicted_loop_type,family = inverse.gaussian,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```



```{r}
model=glm(reactivity+1e-12~sequence+structure,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)
```


### deg_Mg_pH10

#### Loi Gamma

Ici on fera énormément de tests pour essayer de voir quels variables apportent des informations utiles.

```{r}
model=glm(deg_Mg_pH10+1e-12~sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_Mg_pH10+1e-12~(sequence+seq_be+seq_af),family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_Mg_pH10+1e-12~sequence+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_Mg_pH10+1e-12~sequence+predicted_loop_type+index_sequence,family = Gamma,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)
```



```{r}
model=glm(deg_Mg_pH10+1e-12~sequence+structure+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

```


#### Inverse.gaussian

```{r}
model=glm(deg_Mg_pH10+1e-12~sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_Mg_pH10+1e-12~(sequence+seq_be),family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_Mg_pH10+1e-12~sequence+index_sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_Mg_pH10+1e-12~sequence+predicted_loop_type,family = inverse.gaussian,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_Mg_pH10+1e-12~sequence+structure,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_pH10)^2,na.rm=TRUE)
```



### deg_pH10

#### Loi Gamma

Ici on fera énormément de tests pour essayer de voir quels variables apportent des informations utiles.

```{r}
model=glm(deg_pH10+1e-12~sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_pH10+1e-12~(sequence+seq_be+seq_af),family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_pH10+1e-12~sequence+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_pH10+1e-12~sequence+predicted_loop_type+index_sequence,family = Gamma,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)
```



```{r}
model=glm(deg_pH10+1e-12~sequence+structure+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

```


#### Inverse.gaussian

```{r}
model=glm(deg_pH10+1e-12~sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_pH10+1e-12~(sequence+seq_be),family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_pH10+1e-12~index_sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_pH10+1e-12~sequence+predicted_loop_type,family = inverse.gaussian,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_pH10+1e-12~sequence+structure,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_pH10)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_pH10)^2,na.rm=TRUE)
```



### deg_Mg_50C

#### Loi Gamma

Ici on fera énormément de tests pour essayer de voir quels variables apportent des informations utiles.

```{r}
model=glm(deg_Mg_50C+1e-12~sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_Mg_50C+1e-12~(sequence+seq_be+seq_af),family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_Mg_50C+1e-12~sequence+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_Mg_50C+1e-12~sequence+predicted_loop_type+index_sequence,family = Gamma,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)
```



```{r}
model=glm(deg_Mg_50C+1e-12~sequence+structure+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

```


#### Inverse.gaussian

```{r}
model=glm(deg_Mg_50C+1e-12~sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_Mg_50C+1e-12~(sequence+seq_be),family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_Mg_50C+1e-12~sequence+index_sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_Mg_50C+1e-12~sequence+predicted_loop_type,family = inverse.gaussian,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_Mg_50C+1e-12~sequence+structure+index_sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_Mg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_Mg_50C)^2,na.rm=TRUE)
```



### deg_50C

#### Loi Gamma

Ici on fera énormément de tests pour essayer de voir quels variables apportent des informations utiles.

```{r}
model=glm(deg_50C+1e-12~sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_50C+1e-12~(sequence+seq_be+seq_af),family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_50C+1e-12~sequence+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_50C+1e-12~sequence+predicted_loop_type+index_sequence,family = Gamma,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)
```



```{r}
model=glm(deg_50C+1e-12~sequence+structure+index_sequence,family = Gamma,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

```


#### Inverse.gaussian

```{r}
model=glm(deg_50C+1e-12~sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_50C+1e-12~(sequence+seq_be+seq_af),family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)
```

```{r}
model=glm(deg_50C+1e-12~sequence+index_sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_50C+1e-12~sequence+predicted_loop_type+index_sequence,family = inverse.gaussian,data = data_train)
#summary(model)
y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)
```


```{r}
model=glm(deg_50C+1e-12~sequence+structure+index_sequence,family = inverse.gaussian,data = data_train)
#summary(model)

y_pred=predict.glm(model,data_val,type="response")
mean((y_pred-data_val$deg_50C)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_train,type="response")
mean((y_pred-data_train$deg_50C)^2,na.rm=TRUE)
```




