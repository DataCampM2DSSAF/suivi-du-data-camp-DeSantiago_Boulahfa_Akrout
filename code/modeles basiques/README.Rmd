---
title: "R Notebook"
output: md_document
---

## Chargement des librairies et des données.
```{r}
library(ggplot2)
library(tidyverse)
source("~/suivi-du-data-camp-DeSantiago_Boulahfa_Akrout/code/projet_fct.R")
```

```{r}
data = read.csv("~/suivi-du-data-camp-DeSantiago_Boulahfa_Akrout/code/data_train.csv")
head(data)
data=data[,-1]
head(data)
```

```{r}
data=data %>% mutate(sequence = as.factor(sequence)) %>% 
  mutate(sequence = as.factor(sequence)) %>% 
  mutate(structure = as.factor(structure)) %>% 
  mutate(predicted_loop_type = as.factor(predicted_loop_type))
```


On filtre maintenant les données qui ont SN_filter=0 :

```{r}
print(sum(data$SN_filter==0)/68) ## Nombre d'individus dont le SN_filter=0
data=data[data$SN_filter==1,]
rownames(data)=NULL#1:108052
```

```{r}
sum(data[,7:11]<0)
for (i in 7:11){
  data[which(data[,i]<0),i]=0
} 
sum(data[,7:11]<0)
```

## Création de la base train/validation :

```{r}
tamp=train_test_split(data)
data_train=tamp$train
data_val=tamp$val
rm(tamp,data)
```

## Modèles simples :

### GLM : loi Gamma

```{r}
model=glm(reactivity+1e-12~sequence,family = Gamma,data = data_train)
summary(model)
```

```{r}
y_pred=predict.glm(model,data_train)
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```

```{r}
model=glm(reactivity+1e-12~sequence+predicted_loop_type,family = Gamma,data = data_train)
summary(model)
```

```{r}
y_pred=predict.glm(model,data_train)
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```


```{r}
model=glm(reactivity+1e-12~sequence+structure,family = Gamma,data = data_train)
summary(model)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```

```{r}
y_pred=predict.glm(model,data_train)
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```


```{r}
model=glm(reactivity+1e-12~(sequence+predicted_loop_type)^2,family = Gamma,data = data_train)
summary(model)
```

```{r}
y_pred=predict.glm(model,data_train)
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```



### GLM : loi gaussienne inverse



```{r}
model=glm(reactivity+1e-12~sequence,family = inverse.gaussian,data = data_train)
summary(model)
```

```{r}
y_pred=predict.glm(model,data_train)
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```

```{r}
model=glm(reactivity+1e-12~sequence+predicted_loop_type,family = inverse.gaussian,data = data_train)
summary(model)
```

```{r}
y_pred=predict.glm(model,data_train)
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```


```{r}
model=glm(reactivity+1e-12~sequence+structure,family = inverse.gaussian,data = data_train)
summary(model)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```

```{r}
y_pred=predict.glm(model,data_train)
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```


```{r}
model=glm(reactivity+1e-12~(sequence+predicted_loop_type)^2,family = inverse.gaussian,data = data_train)
summary(model)
```

```{r}
y_pred=predict.glm(model,data_train)
mean((y_pred-data_train$reactivity)^2,na.rm=TRUE)

y_pred=predict.glm(model,data_val)
mean((y_pred-data_val$reactivity)^2,na.rm=TRUE)
```